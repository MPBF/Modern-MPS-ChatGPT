# 🚀 MPBF Next - برومبت تطوير النظام المتكامل لإدارة مصنع الأكياس البلاستيكية

---

## ✅ الخطوة 1: تعريف المشروع والغرض منه

### 🏭 اسم المشروع:
**MPBF Next** (Modern Plastic Bag Factory - النسخة المتطورة)

### 🎯 الغرض من المشروع:
نظام ذكي حديث لتشغيل وإدارة مصنع أكياس بلاستيكية:
- واجهة باللغة العربية قابلة للترجمة.
- تصميم موجه للجوال أولاً.
- تتبع كامل للطلب من البداية إلى التسليم.
- يشمل الموارد البشرية، الإنتاج، الجودة، المستودع.
- يحتوي على مساعد ذكي ينفذ أوامر صوتية/نصية.
- يدعم البيع كنظام ERP صناعي مرن وقابل للتخصيص.

---

## ✅ الخطوة 2: التقنية المستخدمة (Tech Stack)

### 🖥️ Frontend:
- React + Vite + TypeScript
- Tailwind CSS (RTL)
- i18n + Framer Motion

### ⚙️ Backend:
- Node.js + TypeScript
- Drizzle ORM
- OpenAI API

### 🗄️ Database:
- PostgreSQL / SQLite (dev)

---

## ✅ الخطوة 3: الموديولات الرئيسية

### 🔹 الإنتاج:
- الطلبات
- أوامر التشغيل
- الرولات
- خلط المواد (A / ABA)
- الهدر

### 🔹 الموارد البشرية:
- الحضور والانصراف
- التدريب
- تقييم الأداء
- المخالفات
- القرارات الإدارية

### 🔹 الصيانة:
- تبليغ الأعطال
- تصنيف الأعطال (مخرطة، لف ماطور...)
- الإجراءات المتخذة

### 🔹 الجودة:
- فحص عشوائي للرولات
- تقييم المواد الخام

### 🔹 المستودع:
- استلام المواد الخام
- صرفها للإنتاج
- استلام المنتجات النهائية
- تجهيز الشحنات
- حركة الجرد

### 🔹 أخرى:
- العملاء
- منتجات العملاء
- الكليشهات
- المكائن
- الأقسام
- المستخدمين
- المواقع
- الموردين
- الجداول المرجعية
- إعدادات النظام
- المساعد الذكي (AI Assistant)

---

## ✅ الخطوة 4: قاعدة البيانات (بالمخطط)

- `users`, `roles`, `sections`
- `customers`, `customer_products`, `cliches`
- `orders`, `job_orders`, `rolls`, `waste`
- `quality_checks`, `maintenance_requests`
- `violations`, `admin_decisions`, `training_records`
- `machines`, `warehouse_transactions`, `suppliers`
- `categories`, `items`, `locations`, `company_profile`

---

## ✅ الخطوة 5: واجهة المستخدم (UI)

### 📁 صفحة التعريفات:
- تبويبات: العملاء، المجموعات، الأقسام، المستخدمين، بيانات المصنع، الكليشهات، المنتجات، المكائن، الموردين، المواقع، الوحدات.

### 🏭 الإنتاج:
- أوامر التشغيل + إدخال وزن الرول
- طباعة QR
- تسجيل العامل والمكينة تلقائيًا
- إدخال الهدر

### 🧪 الجودة:
- جدول فحص الجودة

### 🏬 المستودع:
- مستودع رئيسي / صالة الإنتاج / الشحن
- صرف واستلام
- تسليم للعميل
- الجرد

### 👷 الموارد البشرية:
- تبويبات: الحضور، التدريب، المخالفات، القرارات

### 🛠️ الصيانة:
- الأعطال، الإجراءات، الطلبات حسب النوع

### 🧠 المساعد الذكي:
- دردشة عربية/إنجليزية
- أوامر صوتية + نصية
- اقتراحات ذكية

### ⚙️ لوحة تحكم الأدمن:
- إدارة النظام، الجداول المرجعية، الترجمة، الصلاحيات، النسخ الاحتياطي

---

## ✅ الخطوة 6: منطق المساعد الذكي (AI Assistant)

- فهم الأوامر (نص/صوت) → تنفيذ أو استيضاح → إشعار → حفظ في السجل
- دعم الأوامر الإدارية والتشغيلية والتحليلية
- متصل بـ Drizzle ORM
- يدعم الردود اللحظية والمقترحات الذكية

---

🧠 هذا البرومبت يمثل خطة تطوير كاملة لمشروع ERP صناعي ذكي قابل للتخصيص والعمل مباشرة من خلال Replit أو GitHub.



## 🔍 منطق العمل - وحدة الإنتاج (Production Module)

### 🧾 الطلبات وأوامر التشغيل:
- الطلب (`order`) قد يحتوي على منتج واحد أو أكثر.
- كل منتج يُحوّل إلى أمر تشغيل (`job_order`) منفصل.
- أمر التشغيل يتم تنفيذه على شكل مجموعة من الرولات (`rolls`) حتى يتم تغطية الكمية المطلوبة.

### 🔄 سير مراحل الإنتاج:
1. **مرحلة الفيلم (الإكسترودر)**:
   - يتم إنتاج رول جديد.
   - تسجل الكمية (الوزن).
   - يتم تعيين عامل ومكينة، ويطبع QR عليه.
   - ينتقل لحالته التالية: `for_printing` أو `for_cutting` حسب المنتج.

2. **مرحلة الطباعة**:
   - إذا كان المنتج "مطبوع"، يتم إظهاره في شاشة الطباعة.
   - لا يتم تغيير وزنه.
   - يتم تحديث حالة الرول إلى `for_cutting`.

3. **مرحلة التقطيع**:
   - يظهر الرول النهائي بعد الطباعة (أو مباشرة إذا غير مطبوع).
   - يتم تسجيل الكمية الناتجة بعد التقطيع.
   - يتم حساب الهدر تلقائياً:  
     **الهدر = وزن الرول - الكمية المقطعة**
   - تُغلق حالة الرول، ويتم تحديث حالة أمر التشغيل.

### ✅ منطق إنهاء أمر التشغيل:
- أمر التشغيل يعتبر "مكتمل" إذا:
  - جميع الرولات المرتبطة به انتهت من آخر مرحلة لها.
  - ويتم تحديث حالته إلى `completed`.

### ⚠️ ملاحظات ذكية:
- إذا كان المنتج لا يحتاج طباعة → يتم تخطي مرحلة الطباعة تلقائيًا.
- كل رول يحمل سجل تتبع (Roll History) يُستخدم في التتبع والتحقيق.
- كل مرحلة لها جدول تسجيل منفصل، مما يساعد على استخراج تقارير دقيقة.



---

## ➕ إضافات وتحسينات على وحدة الإنتاج:

### 🧾 الطلبات (orders):
- إضافة الاسم بالعربية `name_ar` والإنجليزية `name_en`.
- إضافة رقم درج العميل `drawer_no`.
- إضافة وقت التسليم المطلوب `delivery_days`.
- إمكانية تفعيل التنبيهات `notifications_enabled` للحصول على إشعارات بكل التحديثات.

---

### 📋 أوامر التشغيل (job_orders):
- يتم توليد الكمية المطلوبة تلقائيًا باستخدام نسبة احتياطية حسب نوع المنتج:
  - علاقي / علاقي بخطاف = 20٪
  - بنانة = 10٪
  - بدون تخريم = 5٪
- العمود `expected_quantity` = `requested_quantity` + نسبة إضافية.
- العمود `produced_quantity` = مجموع كميات التقطيع للرولات التابعة لأمر التشغيل.

---

### 🌀 الرولات (rolls):

#### مرحلة الفيلم:
- يتم إنشاء الرول فقط في هذه المرحلة.
- عند إنشاء الرول يتم إدخال الكمية + تحديد الماكينة.
- الكمية تخصم من الكمية المطلوبة لأمر التشغيل.
- عند اكتمال الكمية → يختفي أمر التشغيل من شاشة الفيلم.

#### مرحلة الطباعة:
- الرولات التي تحتاج طباعة تنتقل تلقائيًا إلى شاشة الطباعة.
- يتم تحديد ماكينة الطباعة، ولا يتم تغيير الوزن.
- بعد طباعة جميع الرولات → يختفي أمر التشغيل من شاشة الطباعة.

#### مرحلة التقطيع:
- يتم إدخال الكمية الناتجة من كل رول.
- الفرق بين كمية الرول وكمية التقطيع = كمية الهدر.
- كل رول يتم تقطيعه يُحدث `produced_quantity` في أمر التشغيل.
- بعد انتهاء جميع رولات أمر التشغيل → يختفي من شاشة التقطيع.

---

🔁 **تدفق العمل الآلي:**
1. الطلب → أوامر تشغيل
2. أوامر تشغيل → فيلم → طباعة (إن وُجد) → تقطيع
3. النظام يتعامل مع كل مرحلة تلقائيًا ويخفي الطلبات المكتملة.



---

## ➕ إضافات وتحسينات على وحدة المستودع:

### 📁 تبويبات وحدة المستودع:

1. **تبويب العمليات (Transactions Tab):**
   - عرض جدول بجميع الحركات (استلام / صرف / جرد / تحويل).
   - إمكانية التصفية حسب التاريخ، الصنف، الموقع، النوع.
   - دعم البحث والطباعة والتصدير لـ Excel / PDF.

2. **تبويب الطلبات قيد الإنتاج:**
   - جدول رئيسي يحتوي على:
     | مسلسل | رقم الطلب | اسم العميل | اسم المندوب | عدد أوامر التشغيل |
   - عند الضغط على الطلب يظهر جدول فرعي بـ:
     | مسلسل | رقم أمر التشغيل | المجموعة | الصنف | الكمية المطلوبة | الكمية المنتجة (المقطعة) | الكمية المستلمة |
   - إمكانية إنشاء استلام جزئي أو كلي لكل أمر تشغيل.
   - عند استلام جميع الكمية:
     - يختفي أمر التشغيل من الجدول.
     - يظهر كرت تجميعي جاهز للتوصيل.

3. **صفحة التوصيل (Delivery Tab):**
   - تعرض جميع الطلبات المستلمة بالكامل.
   - لكل طلب:
     - معلومات العميل، المندوب، العنوان، رقم المركبة.
     - حالة التوصيل: "جاهز" ← "تم التوصيل"
   - دعم التوصيل الجزئي أو الكلي.
   - بعد التوصيل، يتم أرشفة الطلب وتحديث الحالة.

---

### 📊 مؤشرات تقدم الطلب:

- لكل طلب وأمر تشغيل، يعرض شريط نسبة إنجاز حسب المرحلة:
  - 🎞️ فيلم (Extruder) %
  - 🖨️ طباعة (Printing) %
  - ✂️ تقطيع (Cutting) %
  - 📥 استلام في المستودع (Receiving) %
  - 🚚 توصيل (Delivery) %

- يتم حساب النسبة تلقائيًا حسب الكمية المنتجة والمستلمة.
- يستخدم اللون الأخضر، الأصفر، الأحمر للدلالة على التقدم أو التأخير.

---

✅ **دعم الاستلام الجزئي والتوصيل الجزئي:**
- النظام يسمح بتقسيم الكمية على دفعات.
- يتم تسجيل كل استلام أو توصيل بتاريخ منفصل.
- تُحسب الكمية الإجمالية لكل طلب تلقائيًا.



---

## 🖨️ خصائص إضافية لوحدة المستودع:

- جميع العمليات (استلام - صرف - تحويل - جرد) قابلة لـ:
  - ✅ الطباعة
  - ✏️ التعديل
  - 🗑️ الحذف

- يمكن إنشاء **سند استلام واحد** يشمل أكثر من أمر تشغيل من طلبات مختلفة.

- يتم توليد رقم مرجعي فريد لكل سند يسهل تتبعه.



---

## ✅ الوحدة الثالثة: الجودة (Quality Control Module)

### 🧪 الجداول الأساسية:

| الجدول | الوظيفة |
|--------|----------|
| `quality_checks` | فحوصات الجودة لكل مرحلة (رولات - خامات) |
| `quality_criteria` | معايير الجودة القابلة للتقييم |
| `quality_ratings` | نتائج التقييم لكل فحص |
| `quality_notes` | ملاحظات/تنبيهات الجودة المرتبطة |

---

### 1. `quality_checks`
- يمثل فحص جودة عشوائي أو دوري.
- الأعمدة:
  - `type`: (raw_material - roll)
  - `reference_id`: رقم الرول أو المادة
  - `stage`: (extruder - printing - cutting - warehouse)
  - `inspector_id`: الموظف الذي أجرى الفحص
  - `date`
  - `passed`: true / false

**ملاحظات:**
- يُجرى الفحص بعد كل مرحلة أو بشكل عشوائي.
- يمكن تسجيل فحص استباقي قبل تسليم الخامات أو أثناء الإنتاج.

---

### 2. `quality_criteria`
- تعريف العناصر التي يتم فحصها، مثل:
  - السماكة
  - التجاعيد
  - الحبر
  - اللون
  - التحمل

**ملاحظات:**
- يمكن تخصيص المعايير حسب المرحلة.
- تستخدم لتوليد نموذج تقييم تلقائي.

---

### 3. `quality_ratings`
- تمثل النتيجة الفعلية لكل معيار ضمن فحص.
- الأعمدة:
  - `check_id`
  - `criterion_id`
  - `score`: (ممتاز - جيد - مقبول - مرفوض)
  - `comment`

**ملاحظات:**
- التقييم يؤثر على مؤشرات الأداء في لوحة التحكم.
- التقييم الضعيف يرسل تنبيه للمشرف.

---

### 4. `quality_notes`
- توثيق أي ملاحظات أو تنبيهات مرتبطة بفحص الجودة.
- يمكن ربطها بأي رول أو مادة أو مرحلة.

---

### 📊 العمليات المدعومة:

| العملية | التوضيح |
|---------|---------|
| **فحص رول** | عند خروج رول من أي مرحلة |
| **فحص خامة** | عند استلام مواد خام من المورد |
| **فحص إنتاج نهائي** | قبل الاستلام في المستودع |
| **تحليل جودة** | عرض تقارير حسب التاريخ، المرحلة، العامل، المادة |

---

### 🧠 ملاحظات ذكية:

- **الفحص دائمًا اختياري** ويمكن تفعيله من قبل المشرف عند الحاجة.
- يتم تخصيص المعايير حسب المنتج أو المرحلة.
- **يمكن إرفاق صور أو ملفات** لكل فحص.
- تظهر التنبيهات في حالة انخفاض التقييم تلقائيًا في لوحة التحكم.



---

## ✅ الوحدة الرابعة: الموارد البشرية (HR Module)

### 📋 الجداول الأساسية:

| الجدول | الوظيفة |
|--------|----------|
| `employees` | بيانات الموظفين |
| `attendance` | سجل الحضور والانصراف |
| `training_sessions` | جلسات التدريب |
| `violations` | مخالفات العمل |
| `hr_decisions` | قرارات إدارية |

---

### 1. `employees`
- يحتوي على بيانات كل موظف:
  - `full_name_ar`, `full_name_en`
  - `department_id`, `role`, `status`
  - `username`, `password_hash`
  - `working_hours_type`: (دوام كامل / ورديات / جزئي)

**ملاحظات:**
- يُربط كل موظف بقسمه الرئيسي والمسمى الوظيفي.
- يحتوي على صلاحيات حسب دوره في النظام.

---

### 2. `attendance`
- يسجل حضور وانصراف الموظفين:
  - `employee_id`
  - `check_in_time`, `check_out_time`
  - `location`
  - `overtime_minutes`
  - `break_in` / `break_out`

**ملاحظات:**
- يتم ربط الحضور بالموقع الجغرافي Geo-Fence.
- التطبيق يمنع الحضور من خارج المصنع.
- يتم حساب العمل الإضافي تلقائيًا إذا تجاوز الدوام المحدد.
- النظام يسمح بـ:
  - تنبيهات عند تسجيل الدخول من خارج النطاق.
  - تسجيل خروج تلقائي عند مغادرة الموقع.

---

### 3. `training_sessions`
- إدارة التدريب للموظفين:
  - `title`, `date`, `duration`, `trainer`, `department`
  - `participants[]`, `evaluation_score`, `certificate_uploaded`

**ملاحظات:**
- كل موظف لديه سجل تدريبي.
- يتم تقييم الأداء بعد التدريب.

---

### 4. `violations`
- تسجل مخالفات الموظف:
  - `employee_id`, `violation_type`, `date`
  - `description`, `action_taken`, `approved_by`

**ملاحظات:**
- أنواع المخالفات: تأخير، غياب، سلوك، مخالفات أمن وسلامة.
- تظهر في تقارير الموارد البشرية وتؤثر على التقييم العام.

---

### 5. `hr_decisions`
- توثيق أي قرار إداري:
  - `title`, `issued_by`, `target_employee_id`, `description`, `date`

**ملاحظات:**
- يشمل قرارات مثل: (نقل، خصم، ترقية، توجيه).
- يدعم الأرشفة والطباعة والتوقيع الإلكتروني.

---

### 📊 المميزات الإضافية:

- **واجهة رئيسية للموارد البشرية** تحتوي على:
  - إحصائيات الحضور والانصراف
  - أكثر الموظفين غيابًا / التزامًا
  - عدد جلسات التدريب المنجزة
  - تنبيهات المخالفات المكررة

- **التقارير الذكية**:
  - تقرير غياب وتأخير يومي / أسبوعي / شهري
  - تحليل الأوفر تايم مقابل الإنتاجية



---

## ✅ الوحدة الخامسة: الصيانة (Maintenance Module)

### 🛠️ الجداول الأساسية:

| الجدول | الوظيفة |
|--------|----------|
| `maintenance_reports` | تبليغات الأعطال من الأقسام المختلفة |
| `maintenance_actions` | الإجراءات التي قام بها فريق الصيانة |
| `maintenance_requests` | طلبات الصيانة الخاصة بالفريق (مخرطة - لف موتور - قطع غيار...) |
| `machines` | ربط كل بلاغ أو إجراء بماكينة محددة |
| `maintenance_types` | تعريف لأنواع الأعطال أو الأعمال المتكررة (اختياري) |

---

### 1. `maintenance_reports`  
- تبليغ عطل يتم إنشاؤه من قبل المستخدمين في المصنع.  
- الأعمدة:
  - `machine_id`
  - `reported_by`
  - `description`
  - `issue_type`: (ميكانيكي - كهربائي - تحكم - غير ذلك)
  - `urgency_level`: (عادي - متوسط - عاجل)
  - `status`: (مفتوح - جاري - تم الإصلاح - ملغى)
  - `reported_at`, `resolved_at`

**ملاحظات:**
- يظهر العطل مباشرة في شاشة الصيانة.
- يمكن إرفاق صور/فيديو للتوضيح.

---

### 2. `maintenance_actions`
- توثيق ما تم من فريق الصيانة:
  - `report_id`
  - `performed_by`
  - `action_description`
  - `duration_minutes`
  - `used_parts[]`
  - `result`: (تم الإصلاح - مؤقت - إحالة خارجية)

**ملاحظات:**
- يرتبط بالإجراء مباشرة سجل زمني.
- يحسب معدل الاستجابة للفريق.

---

### 3. `maintenance_requests`
- طلب يتم رفعه من الفريق نفسه للحصول على دعم خارجي أو مواد:
  - `title`
  - `type`: (قطع غيار - لف موتور - مخرطة - رولات طباعة)
  - `details`
  - `requested_by`
  - `status`: (معلق - جاري - تم)

**ملاحظات:**
- يمكن ربط الطلب بإجراء صيانة سابق.
- يظهر في لوحة تحكم مسؤول المشتريات أو المدير.

---

### 📊 الإضافات الذكية:

- **لوحة مؤشرات الصيانة**:
  - عدد الأعطال المفتوحة
  - أكثر المكائن تعطلاً
  - معدل الاستجابة (من وقت التبليغ حتى الإصلاح)
  - تصنيف الأعطال حسب القسم

- **البحث والأرشفة**:
  - إمكانية البحث بتاريخ - ماكينة - موظف - نوع العطل
  - يمكن طباعة تقارير الأعطال أو الإجراءات

- **التنبيهات**:
  - تنبيه تلقائي عند فتح تبليغ عطل "عاجل"
  - تنبيه إذا لم يُغلق التبليغ خلال فترة محددة



---

## ✅ الوحدة السادسة: المساعد الذكي (AI Assistant Module)

### 🤖 المهام الرئيسية:

| الوظيفة | الوصف |
|---------|-------|
| أوامر صوتية ونصية | يستطيع المستخدم التفاعل مع النظام باستخدام الكلام أو الكتابة |
| تنفيذ الأوامر | يتم تحويل الطلبات إلى عمليات على قاعدة البيانات |
| التحليلات الذكية | عرض مؤشرات الأداء KPIs وتقارير دورية بناءً على الإنتاج |
| التنبيهات التلقائية | إشعار المستخدمين بالمشاكل، التأخيرات، أو الفرص |

---

### 🧠 الخصائص الذكية:

- **تحليل النشاط**:
  - متابعة أداء الإنتاج، الحضور، وجودة الخامات.
  - الكشف عن الأنماط غير الطبيعية.

- **المساعد السياقي**:
  - يفهم دور المستخدم (عامل، مشرف، أدمن) ويقترح المهام المناسبة له.
  - يعطي توصيات مباشرة لتحسين الكفاءة.

- **واجهة دردشة تفاعلية**:
  - تعرض نتائج مباشرة عند إدخال الأوامر.
  - دعم كامل للغة العربية.

- **تنفيذ مباشر للأوامر**:
  - أمثلة:
    - "أضف عميل جديد"
    - "أعرض أوامر الإنتاج المتأخرة"
    - "سجل حضور لعامل اسمه أحمد"

---

### 📊 لوحة المساعد:

- تبويب تحليلات:
  - إنتاج اليوم - نسبة الهدر - عدد الرولات - أعلى ماكينة إنتاجًا

- تبويب الدردشة:
  - واجهة تفاعلية مع إمكانية تحويل الصوت إلى نص

- تبويب الأتمتة:
  - مهام مقترحة تلقائيًا مثل:
    - إرسال إشعار للمشرف عند تأخير أمر إنتاج
    - طلب تقييم جودة عند تجاوز نسبة الهدر المسموحة

---

### 🛠️ الربط مع OpenAI:

- يستخدم GPT لتحليل النية (Intent Detection)
- يتعامل مع الجداول عبر Drizzle ORM
- يتحقق من الصلاحيات قبل تنفيذ أي أمر
- يُظهر إشعار بعد كل عملية يتم تنفيذها



---

## ✅ الوحدة السابعة: لوحة تحكم الأدمن (Admin Dashboard)

### 🧩 المهام الرئيسية:

| الوظيفة | الوصف |
|---------|-------|
| إدارة النظام | تعديل إعدادات عامة مثل اللغة، التوقيت، شعار المصنع |
| إدارة المستخدمين | إضافة وتعديل المستخدمين، تعيين الصلاحيات |
| إدارة الأقسام | ربط الموظفين، المكائن، العمليات حسب الأقسام |
| إدارة الموديلات | التحكم بالوحدات الظاهرة حسب احتياج المصنع |
| إدارة الترجمة | تعديل ملفات اللغة (JSON) مباشرة |
| إدارة النسخ الاحتياطي | تحميل نسخة احتياطية واستعادتها عند الحاجة |
| مراقبة النظام | إظهار آخر العمليات، تنبيهات، مشاكل محتملة |

---

### 🛠️ المميزات الفنية:

- **تحكم كامل في صلاحيات النظام**:
  - يمكن تحديد من يمكنه الوصول لأي وحدة أو تبويب.
  - ربط الصلاحيات بالدور + القسم معًا.

- **مراقبة الأداء في الوقت الحقيقي**:
  - عرض نشاط النظام (من سجل الدخول وحتى الإنتاج)
  - إمكانية إيقاف أي وحدة أو تعطيلها مؤقتًا

- **إعدادات النظام**:
  - تفعيل أو إخفاء وحدات حسب طبيعة المصنع
  - ضبط الوقت الرسمي للعمل، الحد الأقصى للأوفر تايم، نطاق GPS

- **إدارة ملفات اللغة**:
  - تحميل ملف الترجمة بصيغة JSON
  - تعديل المفاتيح مباشرة من واجهة الأدمن

- **النسخ الاحتياطي**:
  - إنشاء نسخة من قاعدة البيانات
  - تحميلها على الجهاز أو رفع نسخة لاستعادتها

---

### 📊 لوحة البيانات (Dashboard):

- عدد الطلبات الجديدة
- أوامر الإنتاج النشطة
- الهدر اليومي
- حضور الموظفين
- أداء كل قسم ومعدل استجابته

---

### 🚨 التنبيهات والتنظيم:

- تنبيه عند زيادة الهدر عن حد معين
- تنبيه عند تأخير الإنتاج أو غياب موظف مهم
- تنبيه في حال لم يتم تسجيل خروج الموظف
- تنبيه عند تجاوز مدة الصيانة المسموحة

---



---

## ✅ الوحدة الثامنة: بيانات المصنع والإعدادات العامة (Factory Info & Settings)

### 🏭 بيانات المصنع:

| الحقل | الوصف |
|-------|-------|
| `factory_name_ar` | اسم المصنع بالعربية |
| `factory_name_en` | اسم المصنع بالإنجليزية |
| `license_number` | رقم الرخصة الصناعية |
| `tax_number` | الرقم الضريبي |
| `city`, `address`, `phone`, `email` | معلومات التواصل |
| `working_hours_per_day` | عدد ساعات العمل الرسمية |
| `default_language` | اللغة الافتراضية للنظام |

**ملاحظات:**
- يتم استخدام هذه البيانات في الطباعة، التقارير، والفواتير.
- واجهة خاصة لتحديث بيانات المصنع مباشرة من لوحة التحكم.

---

### ⚙️ الإعدادات العامة للنظام:

| الإعداد | الوظيفة |
|--------|----------|
| `gps_fence_radius` | نطاق الموقع الجغرافي للمصنع لتفعيل الحضور |
| `default_overtime_minutes` | الحد المسموح بعده باحتساب العمل الإضافي |
| `alert_waste_percent` | النسبة المسموحة للهدر قبل التنبيه |
| `auto_logout_on_exit` | تفعيل تسجيل الخروج التلقائي عند مغادرة الموقع |
| `enable_modules[]` | تفعيل / إيقاف أي وحدة في النظام |
| `enable_multi_language` | دعم لغات متعددة في الواجهة |
| `notification_channels[]` | نوع التنبيهات: (بريد، شاشة، واتساب مستقبلاً) |

**ملاحظات:**
- التعديلات تتم فقط من حساب أدمن له صلاحية "إعدادات".
- جميع الإعدادات تحفظ مباشرة في قاعدة البيانات ويمكن عمل نسخة منها.

---

### 🔐 الحماية والنسخ:

- يتم حفظ جميع الإعدادات في جدول خاص مثل `system_settings`.
- عند كل تعديل يتم إنشاء سجل "تغيير" لعرضه في سجل الأدمن.
- يوجد خيار لإنشاء نسخة احتياطية كاملة من الإعدادات.



---

## ✅ الوحدة التاسعة: الترجمة (Translation Management)

### 🌐 الخصائص:

| الوظيفة | الوصف |
|---------|--------|
| دعم لغات متعددة | عربي، إنجليزي، ويمكن التوسعة للغات أخرى |
| ملفات JSON | تستخدم ملفات مفاتيح للترجمة مثل: `ai.json`, `orders.json`... |
| واجهة تعديل | يمكن للأدمن تعديل القيم مباشرة من النظام |
| التحقق من التكرار | تنبيه تلقائي عند وجود مفاتيح مكررة |
| تحميل / تصدير | دعم تحميل الملف كامل بصيغة JSON أو Excel لتعديله خارجيًا |

**ملاحظات:**
- كل صفحة أو وحدة لها ملف ترجمة مستقل.
- يتم استخدام مفتاح `ar_name` في كل جدول تعريفي.

---

## ✅ الوحدة العاشرة: الإحصائيات (Live Statistics & KPIs)

### 📊 المؤشرات المباشرة:

- إجمالي أوامر الإنتاج اليوم
- نسبة الهدر
- عدد الرولات المنتجة
- أعلى ماكينة إنتاجاً
- الموظف الأعلى إنتاجًا
- الطلبات المتأخرة

### 📍 التصفية والفلترة:

- حسب القسم
- حسب العميل
- حسب نوع المنتج
- حسب التاريخ

### 💡 المميزات:

- عرض حي Dashboard
- مؤشرات ملونة حسب الأداء (أخضر/أصفر/أحمر)
- يمكن تخصيص المؤشرات حسب الأدمن

---

## ✅ الوحدة الحادية عشرة: التقارير (Reports Module)

### 🧾 أنواع التقارير:

| النوع | الوصف |
|------|--------|
| تقارير الإنتاج | حسب العامل، المكينة، المرحلة، أو أمر التشغيل |
| تقارير الحضور والانصراف | إجمالي ساعات العمل، التأخير، الغياب |
| تقارير الجودة | نتائج الفحص، نسبة المواد المرفوضة |
| تقارير المستودع | حركة الأصناف، الكميات المستلمة، المخزون الحالي |
| تقارير الهدر | حسب المرحلة أو المنتج أو الماكينة |
| تقارير العملاء | الطلبات - التوصيل - المتأخرة |

### 📤 التصدير:

- جميع التقارير تدعم التصدير PDF / Excel
- إمكانية إرسالها بالبريد داخليًا
- إمكانية تحديد الفترة الزمنية والنطاق لكل تقرير

---



---

### 🆕 خاصية التبليغ الداخلي (Internal Reporting / Requests)

تمت إضافة تبويب جديد داخل وحدة الموارد البشرية يُمكّن الموظفين من التواصل مع الإدارة أو الأقسام الأخرى بسهولة في حال حدوث أمر مهم.

### 📥 الجداول الجديدة:

#### 1. `hr_reports`
| الحقل | الوصف |
|-------|--------|
| `report_type` | نوع البلاغ (استفسار - بلاغ - طلب إذن - اقتراح - شكوى) |
| `report_title` | عنوان مختصر للبلاغ |
| `details` | التفاصيل الكاملة للبلاغ |
| `reported_by` | الموظف المُبلّغ |
| `department_id` | الجهة المستهدفة (الإدارة - الإنتاج - الموارد...) |
| `status` | (مفتوح - جارٍ المعالجة - تم الرد - مغلق) |
| `response` | الرد من الجهة المعنية |
| `reported_at`, `responded_at` | التواريخ الزمنية |

### 📤 الميزات:

- يمكن لأي موظف رفع بلاغ من جواله في أي وقت
- يظهر البلاغ مباشرة في لوحة تحكم المسؤول المختص
- يمكن للموارد البشرية تحويل البلاغ لقسم آخر عند الحاجة
- دعم التعليقات المتبادلة بين الإدارة والموظف
- إشعار فوري عند تسجيل بلاغ جديد أو الرد عليه

### 📌 حالات الاستخدام:

| الحالة | مثال |
|--------|------|
| استفسار | "ما هو وقت تسليم طلبي؟" |
| طلب إذن | "أرغب بالخروج مبكرًا اليوم بسبب موعد طبي" |
| بلاغ إداري | "تم ملاحظة تسريب زيت في ماكينة رقم 4" |
| شكوى | "أحد الزملاء لا يلتزم بوقت الاستراحة" |
| اقتراح | "اقتراح تعديل مكان طابعة QR لتكون أقرب" |

---



---

## ☁️ ملاحظات تنفيذ المشروع على Replit

### 🧱 الهيكلية المقترحة للمشروع:

```bash
/project-root
  /client                 ← الواجهة الأمامية (React + Tailwind + i18n)
  /server                 ← API (Node.js + Drizzle ORM)
  /schema                 ← ملفات قاعدة البيانات (Drizzle Schema)
  /locales                ← ملفات الترجمة (ar, en)
  /types                  ← أنواع TypeScript المشتركة
  .env                    ← المتغيرات البيئية الحساسة
  replit.nix              ← إعداد البيئة على Replit
  .replit                 ← ملف التشغيل
```

---

### 🔐 المتغيرات البيئية المطلوبة `.env`

```env
DATABASE_URL=
OPENAI_API_KEY=
JWT_SECRET=
DEFAULT_LANGUAGE=ar
FACTORY_NAME_AR=مصنع أكياس البلاستيك الحديث
FACTORY_NAME_EN=Modern Plastic Bag Factory
```

---

### 🔁 GitHub Actions + بيئة dev/prod

يدعم المشروع التكامل مع GitHub Actions لتفعيل CI/CD:

- `dev` ← بيئة التطوير داخل Replit
- `prod` ← بيئة الإنتاج خارج Replit (VPS أو Railway لاحقاً)

ملف `github/workflows/deploy.yml` يحتوي على:

```yaml
on:
  push:
    branches: [ main ]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Install deps
        run: npm install
      - name: Build Client
        run: cd client && npm run build
      - name: Deploy to Replit
        run: echo "Custom deploy script or sync with Replit"
```

---

### 🌍 دعم الترجمة (i18n)

- ملفات الترجمة توضع داخل `locales/ar/*.json`, `locales/en/*.json`
- استخدام مكتبة مثل `react-i18next` للواجهة الأمامية
- ربطها بواجهة خاصة لتعديل النصوص من داخل لوحة تحكم الأدمن

---

### 🛡️ النسخ الاحتياطي والاستعداد:

- إنشاء زر للنسخ الاحتياطي اليدوي داخل صفحة الأدمن
- أو إعداد Cron Job في Replit/Server لعمل نسخة احتياطية كل 48 ساعة

---

### ✅ البداية النموذجية:

ابدأ بإنشاء صفحة `Dashboard` شاملة، تحتوي على روابط رئيسية لكل وحدة مثل:
- التعريفات
- الإنتاج
- الموارد البشرية
- المستودع
- الجودة
- التقارير
- المساعد الذكي

وبعدها يتم تفكيك كل تبويب إلى صفحة مستقلة مع الوقت.


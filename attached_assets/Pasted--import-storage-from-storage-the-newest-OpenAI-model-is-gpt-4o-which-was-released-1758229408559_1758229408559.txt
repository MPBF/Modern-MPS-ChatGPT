
import { storage } from "../storage";

// the newest OpenAI model is "gpt-4o" which was released May 13, 2024. do not change this unless explicitly requested by the user
const openai = new OpenAI({ 
  apiKey: process.env.OPENAI_API_KEY 
});

interface IntelligentReport {
  title: string;
  summary: string;
  insights: string[];
  recommendations: string[];
  data: Record<string, any>;
  charts?: any[];
}

export class AIReports {
  // توليد تقرير الإنتاج الذكي
  static async generateProductionReport(params?: any): Promise<IntelligentReport> {
    try {
      // جمع البيانات
      const stats = await storage.getDashboardStats();
      const jobOrders = await storage.getJobOrders();
      const machines = await storage.getMachines();
      const rolls = await storage.getRolls();
      
      // تحليل البيانات باستخدام AI
      const analysis = await openai.chat.completions.create({
        model: "gpt-4o",
        messages: [
          {
            role: "system",
            content: `أنت محلل بيانات متخصص في الإنتاج الصناعي. حلل البيانات التالية وقدم تقريراً شاملاً بتنسيق JSON:

{
  "title": "عنوان التقرير",
  "summary": "ملخص تنفيذي موجز",
  "insights": ["نقطة تحليلية 1", "نقطة تحليلية 2", "..."],
  "recommendations": ["توصية 1", "توصية 2", "..."],
  "key_metrics": {
    "metric1": "قيمة1",
    "metric2": "قيمة2"
  }
}`
          },
          {
            role: "user",
            content: `بيانات الإنتاج:
الطلبات النشطة: ${stats.activeOrders}
معدل الإنتاج: ${stats.productionRate}%
نسبة الجودة: ${stats.qualityScore}%
نسبة الهدر: ${stats.wastePercentage}%
عدد أوامر التشغيل: ${jobOrders.length}
عدد المكائن: ${machines.length}
عدد الرولات: ${rolls.length}

Code Diagnostics
'params' is declared but its value is never read.
(typescript)
Ln 20, Col 41
Property 'getJobOrders' does not exist on type 'DatabaseStorage'.
(typescript)
Ln 24, Col 39
'params' is declared but its value is never read.
(typescript)
Ln 87, Col 38
'params' is declared but its value is never read.
(typescript)
Ln 138, Col 42
'params' is declared but its value is never read.
(typescript)
Ln 193, Col 36
Property 'getOrders' does not exist on type 'DatabaseStorage'. Did you mean 'getAllOrders'?
(typescript)
Ln 196, Col 36
Parameter 'o' implicitly has an 'any' type.
(typescript)
Ln 216, Col 35
Parameter 'o' implicitly has an 'any' type.
(typescript)
Ln 217, Col 35
Parameter 'o' implicitly has an 'any' type.
(typescript)
Ln 237, Col 42
Parameter 'o' implicitly has an 'any' type.
(typescript)
Ln 238, Col 42
'params' is declared but its value is never read.
(typescript)
Ln 248, Col 57
Property 'getOrders' does not exist on type 'DatabaseStorage'. Did you mean 'getAllOrders'?
(typescript)
Ln 354, Col 36
Parameter 'o' implicitly has an 'any' type.
(typescript)
Ln 359, Col 40
Parameter 'o' implicitly has an 'any' type.
(typescript)
Ln 360, Col 40
